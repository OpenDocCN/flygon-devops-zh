# 第十章：容器和 OpenStack 的最佳实践

在本章中，我们将重点关注在 OpenStack 上运行容器的优势以及在 OpenStack 上部署和保护容器的最佳实践。具体来说，我们将关注以下主题：

+   不同 OpenStack 项目的优势

+   保护和部署容器的最佳实践

# 不同 OpenStack 项目的优势

OpenStack 提供容器平台和应用程序可以使用的资源和服务。它提供了构建可扩展云的标准。它还提供了共享网络、存储和许多其他高级服务。它具有可编程的 API，可用于按需创建基础设施。用户可以使用不同的 OpenStack 服务来处理他们的容器相关工作负载。

用户可以使用 Magnum 来提供和管理他们的 COE。Magnum 提供了多租户的能力，这意味着一个 COE 集群只属于一个租户。这使得容器隔离成为可能，属于不同租户的容器不会被调度到同一台主机上。Magnum 内置支持 Kubernetes、Swarm 和 Mesos。Magnum 还提供 TLS 支持，以确保集群内部服务和外部世界之间的安全通信。

用户可以使用 Zun 直接在 OpenStack 上部署他们的容器工作负载，而不使用 COEs。Zun 提供完整的容器生命周期管理支持。它还通过 Kuryr 提供 Docker 网络支持。这意味着用户可以使用 Neutron 网络来处理他们的容器和虚拟机工作负载，并在其中相互访问。Zun 还为容器提供了 OpenStack Cinder 支持，用于持久存储。Zun 具有内置的多租户能力，并使用 KeyStone 进行身份验证支持。

OpenStack Kolla 提供支持，可以在容器内部部署 OpenStack 服务。这将产生新的、快速的、可靠的、可组合的构建模块。Kolla 通过将每个服务大部分打包为 Docker 容器中的微服务，简化了部署和持续运营。用户可以使用 Kolla 将 OpenStack 服务部署在 Docker 容器或 Kubernetes pod 中。

用户可以使用 Murano 在 OpenStack 上部署他们的容器化应用程序。Murano 将为部署创建基础设施并在其上部署容器化应用程序。

# 保护和部署容器的最佳实践

由于其模块化和在服务器之间的可移植性，容器正在取代虚拟机来运行大部分企业软件。然而，容器也存在一些风险。一个明显的风险与通过克隆分发容器相关。如果基础镜像中存在未修补的漏洞，所有克隆和继承自基础镜像的应用程序也会受到影响。

第二个主要风险是容器系统的默认用户，即 root 用户。如果攻击者获得 root 用户的访问权限，他不仅可以访问其他容器内部，还可以获得主机操作系统中的 root 权限。这可能是毁灭性的！

以下是一些保护和部署容器的最佳实践：

+   用户应始终使用轻量级 Linux 操作系统。轻量级操作系统可以减少攻击的机会。它还使应用更新变得更加容易。

+   用户应保持所有容器镜像更新。保持所有镜像更新可以确保它们没有最新的漏洞。始终将您的镜像保存在集中式存储库中，并对其进行版本控制和标记。

+   用户应自动化所有安全更新。这可以确保补丁快速应用到您的基础设施上。

+   用户应始终扫描其容器镜像以查找潜在缺陷。有许多扫描工具，如 CoreOS 的 Clair，Dockscan 和 Twistlock，它们会将容器清单与已知漏洞列表进行比较，并在检测到任何漏洞时向您发出警报。

+   用户不应在容器中运行多余的面向网络的服务。

+   用户应避免在容器内挂载主机目录，因为这可能会使容器内部的主机敏感数据暴露出来。

+   用户应始终对容器的资源消耗定义限制。这将有助于避免主机上所有资源的消耗，并使其他容器陷入饥饿状态。

+   用户应保护他们的 Docker 主机，并且不应向其他用户提供 root 用户的敏感信息。

+   用户应该使用 TLS 运行他们的 Docker 注册表。只有有效用户才能拉取和推送镜像到注册表。

+   用户应始终监视容器行为以发现异常。

+   用户可以使用清晰的容器或开源 Hyper 来提供更多安全性，因为它们提供更多的隔离。

# 总结

在整本书中，我们遇到了 OpenStack 中几个与容器相关的项目以及它们的关键特性。在本章中，我们总结了本书中所有项目的优势，用于运行容器工作负载。我们还解释了容器中的不同安全问题以及解决这些问题的最佳实践。
