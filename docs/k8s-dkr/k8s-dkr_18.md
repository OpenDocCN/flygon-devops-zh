# 第十五章：评估

# 第一章

1.  正确答案：（B）False。基于一个架构的容器无法在不同的架构上运行。例如，使用 x86 架构创建的镜像将无法在基于 ARM 的架构上运行。

1.  正确答案：（D）联合文件系统。Docker 使用联合文件系统来管理多个镜像层。这些层从顶部到底部读取，以提供单个文件系统的外观。

1.  正确答案：（D）Overlay2。运行内核版本为 4.0 或更高版本的系统将使用 Overlay2 存储驱动程序。

1.  正确答案：（C）容器层。对运行中容器文件系统所做的任何更改都存储在最顶层，称为容器层。

1.  正确答案：（C）**docker exec -it <container> /bin/bash**。**docker exec**命令用于在容器中执行进程。使用**-it**选项告诉 exec 命令在执行时使用交互式终端。您要执行的进程是最后一个参数，因为我们想要访问容器的 Bash shell，所以我们执行**/bin/bash**。

1.  正确答案：（B）False。当停止运行的容器时，守护程序只会停止运行的镜像。容器层将保留在主机文件系统上。如果要删除容器，必须使用**docker rm**命令从守护程序中删除容器。

1.  正确答案：（B）**docker ps -a**。要查看所有正在运行和已停止的容器列表，请使用**docker ps -a**命令。如果使用**-all**或**-list**，守护程序将将选项解释为**-l**，这将仅列出最新的容器。列出最新的容器将排除停止时间较长的容器。

# 第二章

1.  正确答案：（B）绑定挂载和（C）卷。只有 Docker 卷和绑定挂载为容器提供持久性。tmpfs 卷存储在 RAM 中，不会写入磁盘。

1.  正确答案：（A）True。必须在容器中使用卷之前创建卷。如果在运行容器之前未创建卷，Docker 将在挂载到容器之前创建卷。

1.  正确答案：（D）32 GB。如果未指定 tmpfs 大小，Docker 将创建一个大小等于主机 RAM 一半的卷。

1.  答案：（B）错误。停止或删除镜像不会默认删除持久卷。要删除卷，可以在 docker rm 命令中添加**-v**选项，或者可以使用**docker volume rm**命令手动删除卷。

1.  答案：（B）命名卷。只有匿名卷和命名卷由 Docker 守护程序管理。

1.  答案：（D）您必须手动删除 Bind 文件夹。由于 Bind 挂载不受 Docker 管理，守护程序无法删除未使用的卷。要删除 Bind 挂载，您需要手动删除 Bind 挂载使用的目录。

# 第三章

1.  答案：（B）错误。Docker 分配的默认桥接有限制。如果您计划在主机上运行多个容器，最佳做法是创建自定义桥接网络。

1.  答案：（C）**192.168.100.10:80**。套接字是 IP 地址和端口的组合。**192.168.100.10:80**是运行在端口**80**上的服务器服务的套接字，IP 地址为**192.168.100.10**。

1.  答案：（C）**docker run -p 8081:8080 -d nginx-web bitnami/nginx**。由于主机已经将端口**8080**绑定到另一个服务，我们不能使用**8080:8080**启动新容器。由于每个 Docker 容器都有自己的 IP 地址，我们仍然可以使用端口**8080**来为容器提供服务，但是传入的主机端口分配必须使用未使用的端口。唯一正确的答案是 C，因为它将主机的端口**8081**绑定到运行在端口**8080**上的容器。

1.  答案：（D）**docker run --network=none -it badimage bash**。如果启动容器而不提供任何网络选项，则容器将尝试在默认的 Docker 桥接网络上运行。要启动一个没有网络的容器，可以通过使用**–network=none**选项将网络设置为 none 来运行镜像。

1.  答案：（B）错误。能够动态更改连接的网络是自定义桥接网络的一个特性。

1.  答案：（B）**65535**。IP 端口的有效范围是**1-65535**。

# 第四章

1.  答案：（C）PersistentVolume。PersistentVolumes 使用 PersistentVolumeClaims 进行声明-在创建 PersistentVolumeClaim 之前，必须存在 PersistentVolume。

1.  答案：（D）Rancher。KinD 包括 local-path-provisioner，这是由 Rancher 创建的。

1.  正确答案：（A）负载均衡器。当集群有多个工作节点时，您需要在集群前面安装一个负载均衡器，以将流量引导到后端工作节点。

1.  正确答案：（B）错误。如*图 5.9*所示，Kubernetes 集群可以有多个 CSIDrivers。这允许集群连接到多个后端存储系统。

# 第五章

1.  正确答案：（D）Ingress 控制器。Ingress 控制器是用于公开服务的附加组件，它不是控制平面的一部分。

1.  **正确答案：（D）ETCD。ETCD 是 Kubernetes 用来存储所有对象及其状态的数据库。**

1.  **正确答案：（C）kube-scheduler**。**kube-scheduler**使用每个工作节点上的**kubelet**的各种标准来调度工作负载。

1.  **正确答案：（B）** **-v****。** **-v** **选项启用来自** **kubectl** **命令的详细输出。**

1.  **正确答案：（D）NodePort**。当您创建一个**NodePort**服务时，它将被分配一个在**30000-32767**之间的端口。每个节点将被更新为该服务和访问它的端口。由于每个节点都知道该服务，任何节点都可以处理传入的请求。

1.  **正确答案：（A）StatefulSet**。**StatefulSet**将根据清单中分配的名称为每个 pod 创建一个已知名称。每个 pod 将接收带有附加数字的名称。为了提供创建控制，当一个 pod 被创建时，它必须在下一个 pod 被创建之前完全部署。

# 第六章

1.  正确答案：（D）通过选择器标签。当您创建一个服务对象时，您包括一个选择器，其中包括与服务端点匹配的标签。任何匹配的 pod 都将被添加为端点。

1.  正确答案：（B）**kubectl get ep <service name>**。服务使用端点来选择接收服务请求的 pod。在进行服务故障排除时的第一步之一是验证是否已分配端点。

1.  正确答案：（B）错误。一些发行版确实在开箱即用时包含对**LoadBalancer**服务的支持，但大多数仍然不包括支持，需要添加诸如 MetalLB 之类的组件。

1.  正确答案：（D）第 4 层。Kubernetes 中使用的两个负载均衡器是第 7 层和第 4 层。第 7 层负载均衡器在 OSI 模型的第 7 层运行，只能接受应用级别的流量，如 HTTP 和 HTTPS。由于第 4 层负载均衡器在 OSI 模型的较低层运行，它们可以访问较低级别的数据包，如直接的 TCP 和 UDP。

1.  正确答案：（A）**NodePort** 和 **ClusterIP**。基本的 Kubernetes 集群不允许 **LoadBalancer** 类型使用多个协议。只有 **ClusterIP** 和 **NodePort** 可以创建一个同时定义 UDP 和 TCP 协议的单个服务。

# 第七章

1.  正确答案：（A）正确。OpenID Connect 是由 IETF 发布的标准：[`openid.net/specs/openid-connect-core-1_0.html`](https://openid.net/specs/openid-connect-core-1_0.html)。

1.  正确答案：（B）**id_token**。**id_token** 包含有关用户身份的声明。**refresh_token** 用于获取新的 **id_token**。**access_token** 用于与身份提供者交互。**certificate_token** 不存在。

1.  正确答案：（C）紧急情况下打破玻璃。当所有其他身份验证解决方案不可用时。记得严格控制这个证书和密钥对。

1.  正确答案：（D）一个不基于用户名称的不可变 ID。这样，如果用户的名称发生变化，这种情况比预期的更常见，他们的访问权限不会改变。

1.  正确答案：（D）设置为 Kubernetes API 服务器可执行文件的标志。您如何设置这些标志将取决于您的发行版，但最终，每个发行版都会在 API 服务器的命令上设置这些标志。

1.  正确答案：（B）错误。被冒充的用户没有被授予默认组；也就是 **system:authenticated**。反向代理需要添加这个组。

1.  正确答案：（B）错误。仪表板不应该有自己的特权。否则，任何可以连接到它的人都可以使用它。

# 第八章

1.  正确答案：（A）错误。RBAC 是授权资源的首选方法。

1.  正确答案：（C）apiGroups、资源、动词。

1.  正确答案：（A）Kubernetes API 参考。这是一个宝贵的工具，将列出每个 API 的 URL。这可以用来确定资源。

1.  正确答案：（B）定义一个 ClusterRole，并在每个命名空间中引用它作为 RoleBinding。这样，每当引用它时，对 ClusterRole 的更改都会反映出来。

1.  答案：（D）在可能的情况下，RoleBindings 和 ClusterRoleBindings 应该引用组。直接引用用户是一种难以维护、审计和调试的反模式。

1.  答案：（B）错误。RBAC 要求列举所有权限。

1.  答案：（B）错误。也可以使用自定义授权 webhook。

# 第九章

1.  答案：（A）错误。仪表板和整个章节中的一致性并不是固有的不安全；部署方式很重要。

1.  答案：（A）没有认证，一个令牌，从反向代理注入。仪表板无法收集用户名、密码或第二因素。

1.  答案：（D）如果上传了令牌，它会被加密并存储在浏览器中作为 cookie。仪表板不会在任何后端持久化会话。

1.  答案：（D）以上都不是。仪表板不知道如何刷新令牌。

1.  答案：（D）在反向代理后面。使用反向代理来管理登录过程，控制会话，并添加多因素认证。

1.  答案：（B）错误。仪表板的 2.0+版本支持模拟。

1.  答案：（B）错误。任何反向代理都可以，如果配置正确的话。

# 第十章

1.  答案：（A）错误。容器是一个进程，不是虚拟机。

1.  答案：（B）如果标记为特权，是的。特权容器可以像特权进程一样访问主机资源。

1.  答案：（C）两者都是。攻击者将多个漏洞串联在一起，以获取对其目标的访问权限。

1.  答案：（B）通过比较 Pod 的请求能力和通过 Pod 的创建者和其自己的**ServiceAccount**授权的策略的并集。策略不能被明确设置。

1.  答案：（A）一个审批控制器，在创建和更新时检查所有 Pod。策略执行不是由**PodSecurityPolicy** API 处理的，只有策略的定义。

1.  答案：（B）错误。确定替代方案、实施替代方案，然后进行废弃过程需要多年时间。

1.  答案：（B）错误。你不会在服务器上以 root 身份运行一个进程，所以在容器中也不要这样做。

# 第十一章

1.  答案：（B）错误。GateKeeper 是微软在 OPA 之上最初构建的工具，但它们并不是同一回事。

1.  答案：（D）Rego 被保存为**ConstraintTemplate**，这是由**GateKeeper**项目定义的**CustomResourceDefenition**。

1.  正确答案：（B）使用直接内置到 OPA 中的自动化框架。OPA 的自动化测试框架提供了一种在部署到 GateKeeper 之前预先验证 Rego 的强大方式。

1.  正确答案：（A）不需要，因为 Rego 将识别迭代步骤。在 Rego 中使用循环时，使用下划线解析所有值，或者使用占位符（如 I 或 j）表示数组索引。Rego 将通过对数组进行迭代来填充计数器。

1.  正确答案：（C）向您的代码添加跟踪函数，并使用**-v**运行**opa test**命令以查看执行跟踪。**opa**会告诉您问题所在。使用其内置工具。

1.  正确答案：（B）错误。约束模板可以包括使用与任何其他 CRD 相同的模式定义的参数。

1.  正确答案：（B）错误。至少在撰写本文时还不能。GateKeeper 目前无法进行变异，因此需要构建额外的 webhook 来填补这一空白。

# 第十二章

1.  正确答案：（D）**falco_rules.local.yaml**。对于已经定制到您的安装的规则的任何更改都应该放在您的**falco_rules.changes.yaml**文件中。您不应该编辑包含在**falco_rules.yaml**中的规则集。**falco.yaml**文件是基本的 Falco 配置文件，不包含任何规则。

1.  正确答案：（B）FluentD。有许多与 Kubernetes 兼容的转发器，但最常用的转发器之一是 FluentD。

1.  正确答案：（C）Kibana。EFK 堆栈包括 ElasticSearch、FluentD 和 Kibana。Kibana 是提供日志可视化和仪表板的组件。

1.  正确答案：（B）Falcosidekick。Falcosidekick 实用程序仅将 Falco 日志转发到中央日志服务器。

1.  正确答案：（A）列表。您可以使用列表在 Falco 中对一组项目进行分组。

# 第十三章

1.  正确答案：（A）正确。Velero 备份只能使用 S3 目标来存储备份。

1.  正确答案：（C）在部署阶段安装 MinIO 并使用 NFS 卷作为持久磁盘。您可以安装 MinIO 并在部署中使用任何持久卷。MinIO 将分配的存储呈现为 S3 存储桶，与 MinIO 兼容。

1.  正确答案：（B）错误。Velero 的功能之一是能够使用一个集群的备份来恢复不同集群中的命名空间和对象。

1.  正确答案：（D）etcdctl。etcdctl 有一个选项可以创建 ETCD 数据库的快照。

1.  正确答案：（D）**Velero create schedule daily-backup --schedule="0 3 * * *"**。这个命令将创建一个每天凌晨 3 点运行的定期备份作业。计划命令接受一个名为**–schedule**的标签，该标签使用 cron 表达式。**0 3 * * ***是每天凌晨 3 点的 cron 表达式。

# 第十四章

1.  正确答案：（A）错误。这不是一个要求，但肯定会让生活变得更容易！

1.  正确答案：（D）以上都不是。没有最少步骤。您如何实现您的流水线将取决于您自己的要求。

1.  正确答案：（C）使用 Git 作为操作配置的权威来源。您不是直接与 Kubernetes API 交互，而是将对象存储在 Git 存储库中，让控制器保持它们同步。

1.  正确答案：（B）没有标准；每个项目和供应商都有自己的实现。对于本章，我们使用了 Tekton，它是 YAML、容器和 shell 脚本的组合。亚马逊、Azure 和 GitHub 都将他们的流水线脚本存储在应用程序源中。对于你写什么没有要求。

1.  正确答案：（B）在 Git 中更新**Deployment**或**StatefulSet**清单，让 GitOps 控制器更新 Kubernetes 中的对象。目标是最小化使用 kubectl，并在 Git 中保持更改记录。

1.  正确答案：（B）错误。这几乎是不可能的。操作员模型，即自定义控制器根据自定义资源创建对象，几乎不会与这个假设一起工作。至少目前还没有。一旦部署了示例，您会发现 Tekton 创建了不在 Git 中的对象。秘密是其他对象，也可能不应该在 Git 中。

1.  正确答案：（A）正确。Kubernetes 是构建平台的平台。虽然肯定有常见的模式和最佳实践，但说到底，Kubernetes 的强大之处在于它让您灵活地自动化您的系统，以最适合您的方式。
